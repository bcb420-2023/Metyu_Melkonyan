---
title: "Assignment1.rmd"
output: html_document
date: "2023-02-04"
---

## Installing dependencies
The dependencies has are already included with the command: 
``` RUN R -e "BiocManager::install(c('DESeq2', 'pheatmap'))" ``` 
```{r}

if (!requireNamespace("GEOmetadb", quietly = TRUE))
  BiocManager::install("GEOmetadb")

```


```{r}

if (!requireNamespace("GEOmetadb", quietly = TRUE))
  BiocManager::install("GEOmetadb")

```

## Downloading the the meta data from GEO

The meta data is installing.
```{r}

if(!file.exists('GEOmetadb.sqlite')) 
  GEOmetadb::getSQLiteFile()

```
## Setting up the tables and connect of the metadb
The connection is established with the databases

```{r}
con <- DBI::dbConnect(RSQLite::SQLite(),'GEOmetadb.sqlite')

```

```{r}
Geo_tables <- DBI::dbListTables(con)
Geo_tables

```

## Retrieving the information about 
* Technology : Highthroughoutput RNA sequencing
* Organism: Homo sapiens
* Within 9 years 

```{r}
results <- DBI::dbGetQuery(con,'select * from gpl limit 5')
knitr::kable(head(results[,1:10]), format = "pipe")

```

```{r}
sql <- paste("SELECT DISTINCT gse.title,gse.gse, gpl.title,",
" gse.submission_date,",
" gse.supplementary_file",
"FROM",
" gse JOIN gse_gpl ON gse_gpl.gse=gse.gse",
" JOIN gpl ON gse_gpl.gpl=gpl.gpl",
"WHERE",
" gse.submission_date > '2014-01-01' AND",
" gse.title LIKE '%Cancer%' AND", 
" gpl.organism LIKE '%Homo sapiens%' AND",
" gpl.technology LIKE '%High-throughput sequencing%' ",
" ORDER BY gse.submission_date DESC",sep=" ")
```
## Result obtaining
The search results from the query can be obtained from the following command

```{r}
rs <- DBI::dbGetQuery(con,sql)
knitr::kable(rs, format = "html")
```
## Breakdown of Supplementary file from the search results

```{r}
counts_files <- rs$supplementary_file[grep(rs$supplementary_file,
                              pattern = "count",ignore.case = TRUE)]
knitr::kable(counts_files, format = "html")
```

## Oncogene expression data obtaining
The following query allows for the **GSE164730** expression data retrieval.

```{r}
sfiles = GEOquery::getGEOSuppFiles('GSE131222')

fnames = rownames(sfiles)
```
## Reading the gene expression data

```{r}
b2 = read.delim(fnames[1],header =TRUE)
head(b2)
```


# The new part from the Assignment_Dataexpression.rmd file
```{r}
gse <- GEOquery::getGEO("GSE131222",GSEMatrix = FALSE)
knitr::kable(data.frame(head(GEOquery::Meta(gse))), format = 'html')
```

```{r}
current_gpl <- names(GEOquery::GPLList(gse))[1]
current_gpl_info <- GEOquery::Meta(GEOquery::getGEO(current_gpl))
current_gpl_info$title
current_gpl_info$submission_date
current_gpl_info$last_update_date
current_gpl_info$organism
length(current_gpl_info$series_id)
length(current_gpl_info$sample_id)
```
#Expression data retrieval
 
```{r}
sfiles = GEOquery::getGEOSuppFiles('GSE131222')
fnames = rownames(sfiles)

```

```{r}
PDCD1_exp =read.delim(fnames[1],header=TRUE,
check.names = FALSE)
```

```{r}
knitr::kable(PDCD1_exp[1:15,1:5], format = "html")
```


```{r}
# Number of PDCD1 gene for the measurements
dim(PDCD1_exp)
```

